#!/usr/bin/env python

import sys
import math
import random

def factorize(n):
    # Check for small prime factors
    for p in [2, 3, 5, 7]:
        while n % p == 0:
            n //= p
            yield p
            if n == 1:
                return
    # Use trial division for small numbers
    for i in range(11, int(math.sqrt(n))+1, 2):
        while n % i == 0:
            n //= i
            yield i
            if n == 1:
                return
    # Use Pollard-Rho algorithm for larger numbers
    if n > 1:
        while True:
            x = random.randint(2, n-1)
            c = random.randint(1, n-1)
            y = x
            d = 1
            while d == 1:
                x = (x*x + c) % n
                y = (y*y + c) % n
                y = (y*y + c) % n
                d = math.gcd(abs(x-y), n)
            if d != n:
                yield from factorize(d)
                yield from factorize(n//d)
                return

if __name__ == '__main__':
    if len(sys.argv) != 2:
        print("Usage: {} <file>".format(sys.argv[0]))
        sys.exit(1)

    filename = sys.argv[1]
    try:
        with open(filename) as f:
            for line in f:
                n = int(line.strip())
                for factor in factorize(n):
                    print("{}=".format(n), factor)
    except IOError:
        print("File not found: {}".format(filename))
        sys.exit(1)
